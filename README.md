# Домашнее задание к занятию «Хранение в K8s»

> Репозиторий: hw-38\
> Выполнил: Асадбек Асадбеков\
> Дата: сентябрь 2025\
> Ссылка: [Манифесты](https://github.com/asad-bekov/hw-38/blob/main/manifests/)

### Задание 1. Volume: обмен данными между контейнерами в поде

**Задача:** Создать Deployment с двумя контейнерами, которые используют общий том для обмена данными.

**Манифест:** [containers-data-exchange.yaml](https://github.com/asad-bekov/hw-38/blob/main/manifests/containers-data-exchange.yaml)

**Скриншоты:**

- Описание пода с контейнерами: ![Описание пода](https://github.com/asad-bekov/hw-38/blob/main/img/1.PNG)

- Продолжение ![Продолж.](https://github.com/asad-bekov/hw-38/blob/main/img/1.1.PNG)

- Вывод команды чтения файла (логи контейнера reader): ![Логи reader](https://github.com/asad-bekov/hw-38/blob/main/img/2.PNG)

### Задание 2. PV, PVC

**Задача:** Создать Deployment приложения, использующего локальный PV, созданный вручную.

**Манифест:** [pv-pvc.yaml](https://github.com/asad-bekov/hw-38/blob/main/manifests/pv-pvc.yaml)

**Скриншоты:

- Проверка создания PV и PVC (Status: Bound): ![kubectl get pv, pvc](https://github.com/asad-bekov/hw-38/blob/main/img/3.PNG)

- Проверка пода: ![kubectl get pods -l app=data-exchange-pvc](https://github.com/asad-bekov/hw-38/blob/main/img/4.PNG)

- Проверка работы пода (логи reader): ![Логи reader](https://github.com/asad-bekov/hw-38/blob/main/img/5.PNG)

- Состояние PV после удаления PVC (Status: Released): ![Описание PV после удаления PVC](https://github.com/asad-bekov/hw-38/blob/main/img/6.PNG)

- Содержимое файла на ноде после удаления PVC: ![Файл на ноде](https://github.com/asad-bekov/hw-38/blob/main/img/7.PNG)

- Содержимое файла на ноде после удаления PV: ![Файл на ноде после удаления PV](https://github.com/asad-bekov/hw-38/blob/main/img/8.PNG)

- Продолжение ![Файл на ноде после удаления PV](https://github.com/asad-bekov/hw-38/blob/main/img/8.1.PNG)

**Объяснение наблюдаемого поведения ресурсов в двух последних шагах.**

**1. Почему PV перешел в статус Released, а не удалился?**

PV перешёл в статус `Released`, потому что для него была указана политика возврата `Retain`.
Эта политика запрещает Kubernetes автоматически удалять том или PV после удаления PVC.
Вместо этого PV остаётся «заблокированным» (в статусе `Released`), сохраняя информацию о том, к какому PVC он был привязан. Для дальнейшего использования требуются ручные действия администратора.
Если бы была выбрана политика `Delete`, то PV и связанные с ним данные были бы удалены автоматически.

------------------------------------------------------------------------

**2. Почему файл остался на диске после удаления и PVC, и PV?**

Файл остался по двум причинам:

1.  **Тип тома --- `hostPath`**
    -   Этот том просто монтирует директорию с диска ноды (хоста) в Pod.
    -   Kubernetes **не управляет** содержимым такой директории.
    -   Удаление PV и PVC убирает только «ссылки» (объекты в Kubernetes), но не сами файлы на хосте.
2.  **Политика `Retain`**
    -   Даже для управляемых томов (например, облачных дисков) политика `Retain` сохраняет данные.
    -   Это сделано для того, чтобы администратор мог вручную забрать или скопировать данные.

**Итог:** Удаление PVC и PV стирает только записи в Kubernetes, а **файлы на диске остаются**.\
В нашем случае данные всё ещё лежат в `/mnt/k8s-data/data.txt`, что и подтверждает команда:

``` bash
cat /mnt/k8s-data/data.txt
```

------------------------------------------------------------------------

### Задание 3. StorageClass

**Цель:** Создать StorageClass и использовать его для динамического связывания.

**Манифест:** [sc.yaml](https://github.com/asad-bekov/hw-38/blob/main/manifests/sc.yaml)

**Скриншоты:**

- Проверка создания StorageClass, привязки PV и PVC и работы пода с StorageClass (логи reader): ![kubectl get sc, get pv, pvc, Логи reader](https://github.com/asad-bekov/hw-38/blob/main/img/9.PNG)

#### Итог по всем заданиям

Успешно выполнены все три задания:

-   **Задание 1:** Volume для обмена данными между контейнерами в поде с помощью `emptyDir`.
-   **Задание 2:** Ручное создание PV и PVC для использования локального хранилища на ноде с политикой `Retain`.
-   **Задание 3:** Создание и использование StorageClass для управления выделением томов.

